# MCP æœåŠ¡å™¨ - Streamable HTTP æ”¯æŒ

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆäº†æ”¯æŒ Streamable HTTP åè®®çš„ MCP (Model Context Protocol) æœåŠ¡å™¨ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **Streamable HTTP åè®®æ”¯æŒ** - å®Œæ•´çš„æµå¼æ•°æ®ä¼ è¾“
- âœ… **OpenAI API å…¼å®¹** - æ”¯æŒæ ‡å‡†çš„ `/v1/chat/completions` æ¥å£
- âœ… **å®æ—¶æ¶ˆæ¯æµ** - Server-Sent Events (SSE) æ”¯æŒ
- âœ… **å¤šå¯¹è¯ç®¡ç†** - æ”¯æŒå¤šä¸ªå¹¶å‘å¯¹è¯ä¼šè¯
- âœ… **æ¶ˆæ¯å†å²** - å®Œæ•´çš„å¯¹è¯å†å²è®°å½•å’Œæ£€ç´¢
- âœ… **å¥åº·ç›‘æ§** - æœåŠ¡å™¨çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯

### æŠ€æœ¯ç‰¹æ€§
- ğŸ”„ **æµå¼å“åº”** - æ”¯æŒå­—ç¬¦çº§æµå¼è¾“å‡º
- ğŸ“¡ **CORS æ”¯æŒ** - è·¨åŸŸèµ„æºå…±äº«
- ğŸ” **è°ƒè¯•å‹å¥½** - è¯¦ç»†çš„æ—¥å¿—å’Œé”™è¯¯å¤„ç†
- âš¡ **é«˜æ€§èƒ½** - åŸºäº Express.js çš„è½»é‡çº§å®ç°
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

## ğŸ“‹ API æ¥å£

### 1. å¥åº·æ£€æŸ¥
```http
GET /health
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "healthy",
  "timestamp": 1703123456789,
  "connections": 2,
  "conversations": 5
}
```

### 2. OpenAI å…¼å®¹æ¥å£

#### éæµå¼èŠå¤©
```http
POST /v1/chat/completions
Content-Type: application/json

{
  "model": "mcp-default",
  "messages": [
    {"role": "user", "content": "ä½ å¥½"}
  ],
  "stream": false
}
```

#### æµå¼èŠå¤©
```http
POST /v1/chat/completions
Content-Type: application/json

{
  "model": "mcp-default",
  "messages": [
    {"role": "user", "content": "ä½ å¥½"}
  ],
  "stream": true
}
```

### 3. MCP ç‰¹å®šæ¥å£

#### è¿æ¥åˆ°æµå¼èŠå¤©
```http
GET /mcp/chat/stream/:conversationId?
```

#### å‘é€æ¶ˆæ¯
```http
POST /mcp/chat/send
Content-Type: application/json

{
  "content": "ä½ å¥½ï¼Œä¸–ç•Œï¼",
  "conversationId": "optional-conversation-id",
  "metadata": {
    "model": "mcp-default",
    "stream": true
  }
}
```

#### è·å–å¯¹è¯å†å²
```http
GET /mcp/conversations/:conversationId
```

#### è·å–æ‰€æœ‰å¯¹è¯
```http
GET /mcp/conversations
```

#### æ¸…ç©ºå¯¹è¯
```http
DELETE /mcp/conversations/:conversationId
```

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨åº”ç”¨
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# æˆ–è€…æ‰‹åŠ¨ç¼–è¯‘å¹¶å¯åŠ¨
npm run compile:electron
npm run electron:serve
```

### 2. è®¿é—® MCP èŠå¤©ç•Œé¢
1. å¯åŠ¨åº”ç”¨åï¼Œç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„ **MCP èŠå¤©** å›¾æ ‡ (ğŸ”—)
2. ç³»ç»Ÿä¼šè‡ªåŠ¨è¿æ¥åˆ° MCP æœåŠ¡å™¨ (ç«¯å£ 3002)
3. å¼€å§‹ä¸ MCP åŠ©æ‰‹å¯¹è¯

### 3. æœåŠ¡å™¨é…ç½®
MCP æœåŠ¡å™¨é»˜è®¤é…ç½®ï¼š
- **ç«¯å£**: 3002
- **CORS**: å¯ç”¨
- **æµå¼ä¼ è¾“**: å¯ç”¨
- **æœ€å¤§è¿æ¥æ•°**: 100

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
# ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œï¼Œç„¶åæ‰§è¡Œæµ‹è¯•
node scripts/test-mcp-server.js
```

æµ‹è¯•è„šæœ¬ä¼šéªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š
- âœ… å¥åº·æ£€æŸ¥
- âœ… æ¶ˆæ¯å‘é€
- âœ… å¯¹è¯å†å²è·å–
- âœ… å¯¹è¯åˆ—è¡¨è·å–
- âœ… OpenAI å…¼å®¹æ¥å£
- âœ… æµå¼å“åº”

### æ‰‹åŠ¨æµ‹è¯•
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ curl æˆ– Postman è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•ï¼š

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3002/health

# å‘é€æ¶ˆæ¯
curl -X POST http://localhost:3002/mcp/chat/send \
  -H "Content-Type: application/json" \
  -d '{"content": "ä½ å¥½ï¼ŒMCPï¼"}'

# OpenAI å…¼å®¹æ¥å£
curl -X POST http://localhost:3002/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "mcp-default",
    "messages": [{"role": "user", "content": "ä»‹ç»ä¸€ä¸‹ MCP åè®®"}],
    "stream": false
  }'
```

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### æ–‡ä»¶ç»“æ„
```
electron/main/
â”œâ”€â”€ mcp-server.ts          # MCP æœåŠ¡å™¨æ ¸å¿ƒå®ç°
â””â”€â”€ index.ts              # ä¸»è¿›ç¨‹ï¼Œé›†æˆ MCP æœåŠ¡å™¨

src/views/mcp/
â””â”€â”€ MCPChatView.vue       # MCP èŠå¤©ç•Œé¢ç»„ä»¶

scripts/
â””â”€â”€ test-mcp-server.js    # æµ‹è¯•è„šæœ¬
```

### æ ¸å¿ƒç»„ä»¶

#### MCPServer ç±»
- **èŒè´£**: MCP åè®®æœåŠ¡å™¨å®ç°
- **ç‰¹æ€§**:
  - Express.js åŸºç¡€
  - SSE æµå¼ä¼ è¾“
  - OpenAI API å…¼å®¹
  - å¯¹è¯ç®¡ç†
  - ç»Ÿè®¡ç›‘æ§

#### MCPChatView ç»„ä»¶
- **èŒè´£**: å‰ç«¯èŠå¤©ç•Œé¢
- **ç‰¹æ€§**:
  - å®æ—¶æ¶ˆæ¯æ˜¾ç¤º
  - æµå¼è¾“å…¥æ•ˆæœ
  - å¯¹è¯å†å²ç®¡ç†
  - æœåŠ¡å™¨çŠ¶æ€ç›‘æ§

## ğŸ”§ é…ç½®é€‰é¡¹

### MCP æœåŠ¡å™¨é…ç½®
```typescript
interface MCPServerConfig {
  port: number              // æœåŠ¡å™¨ç«¯å£
  enableCors?: boolean      // æ˜¯å¦å¯ç”¨ CORS
  maxConnections?: number   // æœ€å¤§è¿æ¥æ•°
  streamingEnabled?: boolean // æ˜¯å¦å¯ç”¨æµå¼ä¼ è¾“
}
```

### æ¶ˆæ¯æ ¼å¼
```typescript
interface MCPMessage {
  id: string                // æ¶ˆæ¯å”¯ä¸€æ ‡è¯†
  role: 'user' | 'assistant' | 'system'
  content: string           // æ¶ˆæ¯å†…å®¹
  timestamp: number         // æ—¶é—´æˆ³
  metadata?: {              // å…ƒæ•°æ®
    model?: string
    temperature?: number
    maxTokens?: number
    stream?: boolean
  }
}
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **ç«¯å£å†²çª**: ç¡®ä¿ç«¯å£ 3002 æœªè¢«å…¶ä»–åº”ç”¨å ç”¨
2. **é˜²ç«å¢™**: å¦‚éœ€å¤–éƒ¨è®¿é—®ï¼Œè¯·é…ç½®é˜²ç«å¢™è§„åˆ™
3. **æ€§èƒ½**: å¤§é‡å¹¶å‘è¿æ¥æ—¶æ³¨æ„æœåŠ¡å™¨æ€§èƒ½
4. **å®‰å…¨**: ç”Ÿäº§ç¯å¢ƒè¯·æ·»åŠ é€‚å½“çš„è®¤è¯å’Œæˆæƒæœºåˆ¶

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¿æ¥å¤±è´¥
- æ£€æŸ¥ MCP æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
- ç¡®è®¤ç«¯å£ 3002 å¯è®¿é—®
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯æ—¥å¿—

#### 2. æ¶ˆæ¯å‘é€å¤±è´¥
- æ£€æŸ¥è¯·æ±‚æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æœåŠ¡å™¨å¥åº·çŠ¶æ€
- æŸ¥çœ‹ç½‘ç»œè¿æ¥

#### 3. æµå¼å“åº”å¼‚å¸¸
- æ£€æŸ¥ SSE è¿æ¥çŠ¶æ€
- ç¡®è®¤æµè§ˆå™¨æ”¯æŒ EventSource
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

### è°ƒè¯•æŠ€å·§
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
2. æŸ¥çœ‹ Electron ä¸»è¿›ç¨‹æ§åˆ¶å°æ—¥å¿—
3. ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯æœåŠ¡å™¨åŠŸèƒ½
4. æ£€æŸ¥æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯é¢æ¿

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- [ ] æ”¯æŒæ›´å¤š AI æ¨¡å‹é›†æˆ
- [ ] å®ç°æ¶ˆæ¯æœç´¢åŠŸèƒ½
- [ ] æ·»åŠ æ–‡ä»¶ä¸Šä¼ æ”¯æŒ
- [ ] ä¼˜åŒ–æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨
- [ ] æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. è¿è¡Œæµ‹è¯•è„šæœ¬è¯Šæ–­é—®é¢˜
3. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

ğŸ‰ **æ­å–œï¼** ä½ å·²ç»æˆåŠŸé›†æˆäº†æ”¯æŒ Streamable HTTP çš„ MCP æœåŠ¡å™¨ï¼
